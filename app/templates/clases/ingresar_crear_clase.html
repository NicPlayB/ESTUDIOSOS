<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Clases Activas</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        .modal-backdrop.show {
            opacity: 0.4 !important;
        }
        .error-text {
            color: #d62828;
            font-size: 0.9rem;
            margin-top: 3px;
        }
        .clase-descripcion {
            font-size: 0.9rem;
            color: #555;
        }
    </style>
</head>

<body class="bg-light">

    

<a href="{% url 'cerrar_sesion' %}" class="text-danger ms-3 mt-3 d-inline-block">
    Cerrar sesi贸n
</a>

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Clases Activas</h2>

        <a href="{% url 'clases_inactivas' %}" class="btn btn-secondary">
            Ver clases inactivas
        </a>
    </div>

    <!-- MENSAJES -->
    {% if messages %}
    {% for message in messages %}

        {% if message.tags == 'success' %}
            <div class="alert alert-success alert-dismissible fade show">
        {% elif message.tags == 'error' %}
            <div class="alert alert-danger alert-dismissible fade show">
        {% elif message.tags == 'warning' %}
            <div class="alert alert-warning alert-dismissible fade show">
        {% elif message.tags == 'info' %}
            <div class="alert alert-info alert-dismissible fade show">
        {% else %}
            <div class="alert alert-secondary alert-dismissible fade show">
        {% endif %}

                {{ message }}
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="alert"></button>
            </div>

    {% endfor %}
{% endif %}

    <!-- ========================= -->
    <!-- PROFESOR -->
    <!-- ========================= -->
    {% if rol == 3 %}

    <!-- BOTN CREAR -->
    <button class="btn btn-primary mb-4"
            data-bs-toggle="modal"
            data-bs-target="#modalCrearClase">
        Crear nueva clase
    </button>

    <!-- MODAL CREAR CLASE -->
    <div class="modal fade {% if crear_form.errors %}show{% endif %}"
         id="modalCrearClase"
         tabindex="-1"
         style="{% if crear_form.errors %}display:block;{% endif %}">

        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Crear Clase</h5>
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <form method="POST">
                        {% csrf_token %}

                        <label class="form-label">Nombre</label>
                        {{ crear_form.nombre }}
                        {% if crear_form.nombre.errors %}
                            <div class="error-text">
                                {{ crear_form.nombre.errors.0 }}
                            </div>
                        {% endif %}

                        <label class="form-label mt-3">Descripci贸n</label>
                        {{ crear_form.descripcion }}
                        {% if crear_form.descripcion.errors %}
                            <div class="error-text">
                                {{ crear_form.descripcion.errors.0 }}
                            </div>
                        {% endif %}

                        <button type="submit"
                                name="crear_clase"
                                class="btn btn-success mt-4 w-100">
                            Crear Clase
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <h4 class="mt-4">Tus clases activas</h4>

    {% for clase in clases_profesor %}
    <div class="card mb-3">
        <div class="card-body">

            <h5 class="card-title mb-1">{{ clase.nombre }}</h5>

            <p class="clase-descripcion mb-2">
                {{ clase.descripcion }}
            </p>

            <p class="mb-2">
                <strong>C贸digo:</strong> {{ clase.codigo_clase }} |
                <strong>Estado:</strong> {{ clase.estado }}
            </p>

            <div class="d-flex gap-2">

                <a href="{% url 'ver_trabajos' clase.id_clase %}"
                   class="btn btn-info btn-sm">
                    Ver trabajos
                </a>

                <!-- EDITAR -->
                <button class="btn btn-warning btn-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#modalEditarClase{{ clase.id_clase }}">
                    Editar
                </button>

                <!-- ELIMINAR -->
                <form method="POST"
                      action="{% url 'editar_eliminar_clase' clase.id_clase %}">
                    {% csrf_token %}
                    <button type="submit"
                            name="eliminar_clase"
                            class="btn btn-danger btn-sm"
                            onclick="return confirm(
                            'No podr谩s eliminar la clase si ya tiene trabajos creados. 驴Deseas continuar?'
                            )">
                        Eliminar
                    </button>
                </form>

            </div>
        </div>
    </div>

    <!-- MODAL EDITAR CLASE -->
    <div class="modal fade"
         id="modalEditarClase{{ clase.id_clase }}"
         tabindex="-1">

        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header bg-warning">
                    <h5 class="modal-title">Editar Clase</h5>
                    <button class="btn-close"
                            data-bs-dismiss="modal"></button>
                </div>

                <form method="POST"
                      action="{% url 'editar_eliminar_clase' clase.id_clase %}">
                    {% csrf_token %}

                    <div class="modal-body">

                        <label class="form-label">Nombre</label>
                        <input type="text"
                               name="nombre"
                               value="{{ clase.nombre }}"
                               class="form-control"
                               required>

                        <label class="form-label mt-3">Descripci贸n</label>
                        <textarea name="descripcion"
                                  class="form-control"
                                  required>{{ clase.descripcion }}</textarea>

                        <!--  NUEVO: CAMBIAR ESTADO -->
                        <label class="form-label mt-3">Estado de la clase</label>
                        <select name="estado" class="form-select">
                            <option value="Activa"
                                {% if clase.estado == "Activa" %}selected{% endif %}>
                                Activa
                            </option>
                            <option value="Inactiva"
                                {% if clase.estado == "Inactiva" %}selected{% endif %}>
                                Inactiva
                            </option>
                        </select>

                    </div>

                    <div class="modal-footer">
                        <button type="submit"
                                name="editar_clase"
                                class="btn btn-success">
                            Guardar cambios
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}

    <!-- ========================= -->
    <!-- ESTUDIANTE -->
    <!-- ========================= -->
    {% if rol == 4 %}

    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            Unirse a una clase
        </div>
        <div class="card-body">
            <form method="POST">
                {% csrf_token %}
                {{ unirse_form.codigo_clase }}
                <button type="submit"
                        name="unirse_clase"
                        class="btn btn-primary mt-3">
                    Unirse
                </button>
            </form>
        </div>
    </div>

    <h4>Clases inscritas activas</h4>

    {% for ins in clases_estudiante %}
        {% if ins.clase.estado == "Activa" %}
        <div class="card mb-2">
            <div class="card-body">

                <h5 class="mb-1">{{ ins.clase.nombre }}</h5>

                <p class="clase-descripcion mb-2">
                    {{ ins.clase.descripcion }}
                </p>

                <p class="mb-2">
                    <strong>C贸digo:</strong> {{ ins.clase.codigo_clase }} |
                    <strong>Estado:</strong> {{ ins.clase.estado }}
                </p>

                <a href="{% url 'ver_trabajos' ins.clase.id_clase %}"
                   class="btn btn-info btn-sm">
                    Ver trabajos
                </a>

            </div>
        </div>
        {% endif %}
    {% endfor %}
    {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% if crear_form.errors %}
<script>
    var modal = new bootstrap.Modal(
        document.getElementById('modalCrearClase')
    );
    modal.show();
</script>
{% endif %}

</body>
</html>
